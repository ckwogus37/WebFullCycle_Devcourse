# <REST API 개발 실습 (1)>

# Part 7. 미니 프로젝트

## Chapter 2. “회원 API 설계”를 바탕으로 기능 구현

### 2. 로그인 기본 로직 및 예외처리

```jsx
// 로그인
app.post('/login', (req,res)=>{
    const {id, password} = req.body

    let userInfo = {} 
    // userInfo 선언 시, {} 로 초기화를 했는데 이것은 undefined가 아니며 truthy값임을 항상 주의해야 한다.
    // id 값을 못 찾았을 경우에도 if문에서는 userInfo가 truthy 의미를 지니기에 if문이 바로 실행되기 때문

    // 입력받은 id와 pwd가 DB에 저장된 회원인지 확인해야 한다
    db.forEach((user, accountNum)=>{
        if(user.id === id){
            userInfo = user
        }
    })
    
    // 만약 id값을 못 찾았으면...
    if(userInfo != {}){ 
        
        console.log("아이디 같은거 찾았다!")

        // password도 맞는지 비교
        if(userInfo.password === password){
            console.log("패스워드도 같다!")
        }else{
            console.log("패스워드가 다르다!")
        }
    }else{
        console.log("입력하신 아이디는 없는 아이디 입니다.")
    }
})
```

- `let userInfo = {}` 선언 시, userInfo는 빈 객체가 되며 이는 truthy 값임을 잊지 말도록 하자
- 그렇다면 { } 와 같은 빈객체는 어떻게 확인할 수 있을 까?
    
    ```jsx
    // empty-demo.js
    
    const obj1 = {
    
    } 
    const obj2 = {
        message : "내용물 있음!"
    } 
    const num = 1
    const str1 = "one"
    const str2 = "" //문자열도 객체다!
    
    console.log(isEmpty(obj1)) // length === 0
    console.log(isEmpty(obj2)) // length === 1
    
    //console.log(Object.keys(num).length === 0) 
    // => 숫자에서는 사용할 수없다!
    // 그래서 객체가 비어있는지 확인하기 전에 객체인지 확인을 먼저하는게 좋다. 
    // obj.constructor 라는 변수를 활용할 수 있다.
    console.log(Object.keys(str1).length === 0) 
    console.log(Object.keys(str2).length === 0) 
    
    function isEmpty(obj){
        if(Object.keys(obj).length === 0){
            return true;
        }else{
            return false;
        }
    }
    ```
    
    - `Object.keys(객체명).length` 를 이용하여 길이가 0인지 아닌지로 판단할 수 있다!
    - 그리고 매번 keys()함수를 사용하는 것보다 함수로 만들어서( isEmpty() ) 사용하면 좋다!

### 3. 로그인 기능 고도화 (완성)

```tsx
let loginUser = {} 
// userInfo 선언 시, {} 로 초기화를 했는데 이것은 Null값이기에 undefined가 아님을 항상 주의해야 한다.
// id 값을 못 찾았을 경우의 if문에서는 Null값이라도 truthy 의미를 지니기에 if문이 바로 실행되기 때문

// 로그인
app.post('/login', (req,res)=>{
    const {id, password} = req.body
    
    checkDB(db,id)
   
    if(isExist(loginUser)){ 
        console.log("아이디 같은거 찾았다!")

        // password도 맞는지 비교
        if(loginUser.password === password){
            console.log("패스워드도 같다!")
        }else{
            console.log("패스워드가 다르다!")
        }
    }else{
        console.log("입력하신 아이디는 없는 아이디 입니다.")
    }
})

// 입력받은 id와 pwd가 DB에 저장된 회원인지 확인해야 한다
function checkDB(db, id){
    db.forEach((user)=>{
        if(user.id === id){
            loginUser = user
        }
    })
}

// 객체 안에 데이터가 있는지 확인해주는 함수
function isExist(obj){
    if(Object.keys(obj).length){
        return true
    }else{
        return false
    }
}
```

- 입력받은 id가 DB에 존재하는지 확인하는 함수 checkDB()와 빈 객체인지 확인하는 함수 isExist()를
    
    [app.post](http://app.post)함수 밖에서 선언하여 app.post 내부에선 호출하는 방식으로 코드 리팩토링을 진행
    

## Chapter 3. “채널 API 설계”를 바탕으로 기능 구현

### 1. 채널 API 설계 (24.03.22 (금) 노션페이지에 모든 설계 정리되있음)

- 채널 API 설계
    
    ▶️ **회원 별 채널 기능**
    
    ( 전제 조건 :  계정 1개당 채널 100개를 가질 수 있다 )
    
    ✔️ 채널 생성 : POST /channels
    
    - req : BODY (channelTitle)
    - res 201 : `${channelTitle}님 채널을 응원합니다` 
              👉 추후에는 실제 다른 페이지를 띄워보자! ex) 채널 관리 페이지
    
    ✔️ 채널 수정 : PUT /channels/:id
    
    - req : URL (id), BODY (channelTitle)
    - res 200 : `채널명이 성공적으로 수정되었습니다. 기존 ${channelTitle} -> 수정${channelTitle}`
    
    ✔️ 채널 삭제 DELETE /channels/:id
    
    - req : URL (id)
    - res 200 : `${채널명}이 정상 삭제 되었습니다.`
             👉 추후에는 유튜브 메인페이지를 띄워보자
    
    ✔️ 채널 전체 “조회” GET /channels
    
    - req : X
    - res 200 : 채널 전체 데이터 ( JSON Array 형식 )
    
    ✔️ 채널 개별 “조회” GET /channels/:id
    
    - req : URL (id)
    - res 200 : 채널 개별 데이터
- **특히, “조회” API의 경우 거의 모든 사이트에서 분명히 사용될 일이 있기때문에 앞으로 다른 프로젝트를 하더라도 꼭 조회 API는 만드는 것이 좋다!**

### 2. 채널 API 코드 틀 ( route )

```jsx
// channel-demo.js

app
    .route('/channels')
    .get((req,res)=>{

    }) // 채널 전체 조회
    .post((req,res)=>{
        
    }) // 채널 개별 생성
    
app    
    .rout('/channels/:id')
    .get((req,res)=>{
        
    }) // 채널 개별 조회
    .put((req,res)=>{
        
    }) // 채널 개별 수정
    .delete((req,res)=>{
        
    }) // 채널 개별 삭제
```

- 초반에 route를 활용하여 보기 쉽게 틀을 세우고 시작한다.

### 3. 채널 생성, 채널 개별 조회, 채널 개별 삭제, 채널 개별 수정

```tsx
app
    .route('/channels')
    .get((req,res)=>{   // 채널 전체 조회

    }) 
    .post((req,res)=>{  // 채널 개별 생성 = db에 저장
        if(req.body.channelTitle){
            db.set(channelNum++, req.body)

            res.status(201).json({
                message : `${db.get(channelNum-1).channelTitle} 채널을 응원합니다!`
            })
        }else{
            res.status(400).json({
                message : "요청 값을 제대로 보내주세요."
            })
        }
    }) 
    
app    
    .route('/channels/:channelNum')
    .get((req,res)=>{   // 채널 개별 조회
        let {channelNum} = req.params
        channelNum = parseInt(channelNum)
        
        let channel = db.get(channelNum)
        if(channel){
            res.status(200).json(channel)
        }else{
            res.status(404).json({
                message : "채널 정보를 찾을 수 없습니다."
            })
        }
    }) 
    .put((req,res)=>{   // 채널 개별 수정
        let {channelNum} = req.params
        channelNum = parseInt(channelNum)

        let channel = db.get(channelNum)
        
        if(channel){
            let oldTitle = channel.channelTitle
            let newTitle = req.body.channelTitle

            channel.channelTitle = newTitle
            db.set(channelNum,channel)

            res.status(200).json({
                message : `채널명이 정상적으로 수정되었습니다. 기존 "${oldTitle}" -> 수정 "${newTitle}"`
            })
        }else{
            res.status(404).json({
                message : "채널 정보를 찾을 수 없습니다."
            })
        }
    }) 
    .delete((req,res)=>{    // 채널 개별 삭제
        let {channelNum} = req.params
        channelNum = parseInt(channelNum)
        
        let channel = db.get(channelNum)
        if(channel){
            db.delete(channelNum)
            res.status(200).json({
                message : `${channel.channelTitle} 채널이 정상적으로 삭제되었습니다.`
            })
        }else{
            res.status(404).json({
                message : "채널 정보를 찾을 수 없습니다."
            })
        }
    }) 
```

### 4. 채널 전체 조회

```jsx
app
    .route('/channels')
    .get((req,res)=>{   // 채널 전체 조회
        if(db.size){
            let channels = []

            db.forEach((value, key)=>{
                channels.push(value)
            })
    
            res.status(200).json(channels) 
        }else{
            res.status(404).json({
                message : "조회할 채널이 없습니다."
            })
        }

    }) 
```

- 이번엔 전체 채널에 대한 데이터를 JSON Array로 전달하였다.
- Array함수인 push()함수를 사용하여 채널 전체 데이터를 저장하였다.
- JSON Array 또한 JSON으로 이루어진 배열이기에 클라이언트에게 응답을 주는 과정에서 JSON 파일을 사용하듯이 그대로 값을 전달해 줄 수 있다. ( `res.status(200).json(channels)` )